<app-navbar></app-navbar>

<app-toast></app-toast>
<div class="flex flex-col md:flex-row justify-center bg-white p-6 items-stretch">
    <!-- Contenedor del formulario -->
    <div class="w-full md:w-1/2 flex flex-col">
        <div class="mt-6 px-4 sm:px-8 md:px-12 lg:px-4 xl:px-8 xl:max-w-2xl">
            <h2 class="text-xl font-bold mb-4">Mi perfil</h2>
            <form [formGroup]="registerForm" (ngSubmit)="register()" class="grid grid-cols-2 gap-8">
                <div>
                    <div class="text-sm font-bold text-gray-700 tracking-wide">
                        Nombre
                    </div>
                    <input type="text" formControlName="name"
                        class="w-full text-lg py-2 border-b focus:outline-none custom-field" [ngClass]="{
                            'red-border': (registerForm.get('name')?.invalid && (touch)) ||
                            this.registerForm.get('name')?.errors?.['minlength'] || 
                            this.registerForm.get('name')?.errors?.['maxlength'] ||
                            (this.registerForm.get('name')?.errors?.['required'] && this.touch)
                        }" placeholder="Nombre" />
                    @if(this.registerForm.get('name')?.errors?.['minlength'] ||
                    this.registerForm.get('name')?.errors?.['maxlength']){
                    <div class="text-red-500">
                        El nombre debe tener entre 3 y 20 caracteres
                    </div>
                    }@else if (this.registerForm.get('name')?.errors?.['required'] && this.touch) {
                    <div class="text-red-500">
                        El nombre es obligatorio
                    </div>
                    }
                </div>

                <div>
                    <div class="text-sm font-bold text-gray-700 tracking-wide">
                        Email
                    </div>
                    <input type="text" formControlName="email"
                        class="w-full text-lg py-2 border-b border-black focus:outline-none custom-field"
                        placeholder="example@gmail.com" [ngClass]="{
                            'red-border':
                            (this.registerForm.get('email')?.errors?.['required'] && this.touch) ||
                            (this.registerForm.get('email')?.errors?.['email'])
                        }" />
                    @if (this.registerForm.get('email')?.errors?.['required'] && this.touch) {
                    <div class="text-red-500">
                        El email es obligatorio
                    </div>
                    }@else if(this.registerForm.get('email')?.errors?.['email']){
                    <div class="text-red-500">
                        El email es inválido.
                    </div>
                    }
                </div>

                <div>
                    <div class="text-sm font-bold text-gray-700 tracking-wide">
                        Primer apellido
                    </div>
                    <input type="text" formControlName="firstLastName"
                        class="w-full text-lg py-2 border-b focus:outline-none custom-field" [ngClass]="{
                            'red-border': (registerForm.get('firstLastName')?.invalid && (touch)) ||
                            this.registerForm.get('firstLastName')?.errors?.['minlength'] || 
                            this.registerForm.get('firstLastName')?.errors?.['maxlength'] ||
                            (this.registerForm.get('firstLastName')?.errors?.['required'] && this.touch)
                        }" placeholder="Primer apellido" />
                    @if(this.registerForm.get('firstLastName')?.errors?.['minlength'] ||
                    this.registerForm.get('firstLastName')?.errors?.['maxlength']){
                    <div class="text-red-500">
                        El nombre debe tener entre 3 y 20 caracteres
                    </div>
                    }@else if (this.registerForm.get('firstLastName')?.errors?.['required'] && this.touch) {
                    <div class="text-red-500">
                        El primer apellido es obligatorio
                    </div>
                    }
                </div>

                <div>
                    <div class="text-sm font-bold text-gray-700 tracking-wide">
                        Contraseña
                    </div>
                    <div class="relative">
                        <input [type]="showPassword ? 'text' : 'password'" formControlName="password"
                            class="w-full text-lg py-2 pr-10 border-b border-black focus:outline-none custom-field"
                            placeholder="Introduce tu contraseña" [ngClass]="{
                                'red-border': (this.registerForm.get('password')?.errors?.['pattern']) ||
                                (this.registerForm.get('password')?.errors?.['required'] && this.touch)
                            }" />
                        <button (click)="togglePasswordVisibility()" type="button"
                            class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-auto focus:outline-none">
                            @if(!showPassword){
                            <i class="far fa-eye"></i>
                            }@else {
                            <i class="far fa-eye-slash"></i>
                            }
                        </button>
                    </div>
                    @if(registerForm.get('password')?.errors?.['pattern']){
                    <div class="text-red-500">
                        La contraseña debe contener al menos 8 caracteres, una letra minúscula, una letra mayúscula y un
                        dígito.
                    </div>
                    }
                    @if(registerForm.get('password')?.errors?.['required'] && this.touch){
                    <div class="text-red-500">
                        La contraseña es obligatoria
                    </div>
                    }
                </div>

                <div>
                    <div class="text-sm font-bold text-gray-700 tracking-wide">
                        Segundo apellido
                    </div>
                    <input type="text" formControlName="secondLastName"
                        class="w-full text-lg py-2 border-b focus:outline-none custom-field" [ngClass]="{
                            'red-border': (registerForm.get('secondLastName')?.invalid && (touch)) ||
                            this.registerForm.get('secondLastName')?.errors?.['minlength'] || 
                            this.registerForm.get('secondLastName')?.errors?.['maxlength'] ||
                            (this.registerForm.get('secondLastName')?.errors?.['required'] && this.touch)
                        }" placeholder="Segundo apellido" />
                    @if(this.registerForm.get('secondLastName')?.errors?.['minlength'] ||
                    this.registerForm.get('firstLastName')?.errors?.['maxlength']){
                    <div class="text-red-500">
                        El nombre debe tener entre 3 y 20 caracteres
                    </div>
                    }@else if (this.registerForm.get('secondLastName')?.errors?.['required'] && this.touch) {
                    <div class="text-red-500">
                        El segundo apellido es obligatorio
                    </div>
                    }
                </div>
            </form>

        </div>
    </div>

    <!-- Contenedor de gustos -->
    <div class="w-full md:w-96 mt-6 md:mt-0 md:ml-8">
        <div class="bg-white p-6">
            <h2 class="text-xl font-bold mb-4">Mis gustos</h2>
            @for(category of categories; track category.category_id){
            <label class="flex mt-1">
                <input type="checkbox" class="custom-checkbox" [checked]="hasCategory(category, userInterests)"
                    (change)="toggleCategory(category)">
                <span class="ml-2 -mt-0.5 text-gray-700">{{ category.name}}</span>
            </label>
            }


        </div>
    </div>
</div>